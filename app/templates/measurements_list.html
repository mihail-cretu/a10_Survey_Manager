{% extends "base.html" %}
{% block title %}Measurements - {{ survey.name }}{% endblock %}
{% block header_menu %}
  <a class="btn btn-measure" href="/site-surveys/{{ survey.id }}/measurements">Measurements</a>
  <a class="btn btn-measure" href="/site-surveys/{{ survey.id }}/measurements/new">New Measurement</a>
{% endblock %}
{% block header_actions %}
  <a class="btn btn-site" href="/site-surveys/{{ survey.id }}">Survey Overview</a>
{% endblock %}
{% block breadcrumbs %}
  {% set breadcrumbs = [
    {"label": "Site Surveys", "url": "/site-surveys"},
    {"label": survey.name, "url": "/site-surveys/" ~ survey.id},
    {"label": "Measurements", "url": None},
  ] %}
  {{ super() }}
{% endblock %}
{% block content %}
<h1>Measurements</h1>
<p class="muted">Survey {{ survey.name }} ({{ survey.code or '-' }}) - Status {{ survey.status }}</p>

<div class="actions" style="margin:12px 0;">
  <a class="btn btn-measure" href="/site-surveys/{{ survey.id }}/measurements/new">New Measurement</a>
  <a class="btn btn-site" href="/site-surveys/{{ survey.id }}/preflight/start">Preflight Checklist</a>
</div>

<div class="card">
  {% if items and items|length %}
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Created</th>
        <th>PSS (uGal)</th>
        <th>PSS* (cm)</th>
        <th>Set Scatter (uGal)</th>
        <th>Gravity (uGal)</th>
        <th>Sets@Drops</th>
        <th>Drops Accepted</th>
        <th>Drops Rejected</th>
        <th>Accepted %</th>
      </tr>
    </thead>
    <tbody>
      {% for m in items %}
      <tr>
        <td class="mono">{{ m.id }}</td>
        <td><a href="/site-surveys/{{ survey.id }}/measurements/{{ m.id }}">{{ m.title }}</a></td>
        <td class="muted mono">{{ m["keys"]["File Created"] }}</td>
        <td>{{ m.pss if m.pss is not none else "-" }}</td>
        <td>{{ (m.pss / 10 * 3.086) | round(1) if m.pss is not none else "-" }}</td>
        <td>{{ m.ssov if m.ssov is not none else "-" }}</td>
        <td>{{ m.gravity if m.gravity else "-" }}</td>
        <td>{{ m.sets_at_drops }}</td>
        <td>{{ m.drops_accepted | int() if m.drops_accepted is not none else "-" }}</td>
        <td>{{ m.drops_rejected | int() if m.drops_rejected is not none else "-" }}</td>
        <td>
          {% if m.accepted_pct is not none %}
            {{ m.accepted_pct }}%
          {% else %}-{% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p class="muted">No measurements yet. Create one.</p>
  {% endif %}
</div>
{% endblock %}

